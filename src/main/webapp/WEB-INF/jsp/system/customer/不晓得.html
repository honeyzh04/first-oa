<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<style type="text/css">
		 .typenum {  
		    width: 168px;  
		    height: 106px;  
		    margin-left: 2px;  
		    outline: none;  
		    border: 1px solid #999;  
		    position: absolute;
        	top: 50px;
        	left:79px;
		}  
		 .makeinp {  
		    width: 167px;  
		    outline: none;  
		    line-height: 30px;  
		    height: 20px;  
		    border: 1px solid #999;
		}  
	</style>
	</head>
	<body>
		<!--<div class="div">
			<label>项目选择:</label>
			<input id="_choice" type="text" value="" /><br>
			<div class="searchBox">
				11
			</div>
			<button onclick="add()">添加</button><br>
			<label>到访时间:</label>
			<input id="_time" type="text" value="" /><br>
			<label>现场顾问:</label>
			<input id="_adviser" type="text" value="" /><br>
			<label>到访项目:</label>
			<textarea id="_text" name="" rows="" cols=""></textarea>
		</div>-->
    <label>项目选择:</label>
    <input type="text" name="makeupCo" id="makeupCo" class="makeinp" onfocus="setfocus(this)" oninput="setinput(this);" placeholder="请选择或输入"/>  
    <button onclick="add()">添加</button>
     <label>到访项目:</label>
	<textarea id="_text" name="" rows="" cols=""></textarea><br>
    	<select name="makeupCoSe" id="typenum" class="typenum" onchange="changeF(this)" size="10" style="display:none;"> 
    		<!--<option value="">梦想派</option>  
        <option value="">成都市金牛区</option>  
        <option value="">时代欣城</option>
        <option value="">绿地悦榕公馆</option>
        <option value="">成都市武侯区</option>
        <option value="">保利.乐活里</option>
        <option value="">新成国际</option>-->
        
    </select> 
    	
             
    <script type="text/html" id="mytempl">
    	{{if data}}

        {{each data value i}}
        <option value="">{{data[i].projectPosition}}</option>  
        {{/each}}

    {{/if}}
    </script>
       
		<script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
		<script src="art-template-web.js" type="text/javascript" charset="utf-8"></script>
		<!--<script src="quickQuery-packer.js" type="text/javascript" charset="utf-8"></script>-->
		<!--<script type="text/javascript">
			function add(){
				//获取每个input框和textarea的value值
				var _choice=$("#_choice").val();
				var _time=$("#_time").val();
				var _adviser=$("#_adviser").val();
				
				
				//点击按钮把input的value添加到textarea的value里
				$("#_text").val(_choice+"\n"+_time+"\n"+_adviser);
				
				
			}
			//模糊查询
			//当input聚焦并输入内容的时候出现div
			//$("#_choice").focus(function(){
				//alert("11")
			//})
		</script>-->
		<script type="text/javascript">
	var TempArr=[];//存储option 
	//获取数据
	    $.ajax({
	    	type:"get",
	    	dataType:"json",
	    	url:"data.json",
	    	async: false,
	    	success:function(data){
	    		console.log(data);
	    		var html = template('mytempl', data);
				$("#typenum").html(html);
	    	},
	    	error:function(err){
	    		console.log("请求数据失败")
	    	}
	    });
	$(function(){  
	    /*先将数据存入数组*/  
	    $("#typenum option").each(function(index, el) {  
	        TempArr[index] = $(this).text();  
	    });  
	    $(document).bind('click', function(e) {    
	        var e = e || window.event; //浏览器兼容性     
	        var elem = e.target || e.srcElement;    
	        while (elem) { //循环判断至跟节点，防止点击的是div子元素     
	            if (elem.id && (elem.id == 'typenum' || elem.id == "makeupCo")) {    
	                return;    
	            }    
	            elem = elem.parentNode;    
	        }    
	        $('#typenum').css('display', 'none'); //点击的不是div或其子元素     
	    });    
	})  
	  
	function changeF(this_) {  
		var option= $("#typenum option:selected").text();
	    $("#makeupCo").val(option);
//	    $(this_).prev("input").val($(this_).find("option:selected").text());  
    $("#typenum").css({"display":"none"});  
	};
	function setfocus(this_){  
	    $("#typenum").css({"display":"block"});  
	    var select = $("#typenum");  
	    for(i=0;i<TempArr.length;i++){  
	        var option = $("<option></option>").text(TempArr[i]);  
	        //console.log(option);
	        select.append(option);  
	    }
	    setinput(this_);  
	};
	  
	function setinput(this_){  
	    var select = $("#typenum");  
	    select.html("");  
	    for(i=0;i<TempArr.length;i++){  
	        //若找到以txt的内容开头的，添option  
	        if(TempArr[i].substring(0,this_.value.length).indexOf(this_.value)==0){  
	            var option = $("<option></option>").text(TempArr[i]);  
	            select.append(option);  
	        }  
	    }  
	};
	function add(){
		//获取每个input框和textarea的value值
		var makeupCo=$("#makeupCo").val();
		//var _time=$("#_time").val();
		//var _adviser=$("#_adviser").val();
		
		
		//点击按钮把input的value添加到textarea的value里
		//$("#_text").val(_choice+"\n"+_time+"\n"+_adviser);
		$("#_text").val(makeupCo);
				
				
	}
</script>
	</body>
</html>
